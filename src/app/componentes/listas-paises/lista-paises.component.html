<div class="container-fluid px-2 px-md-5">
  <!-- Botón para iniciar juego -->
  <div class="row mb-4">
    <div class="col-12 text-center">
      <button
        class="btn btn-success btn-lg mb-3"
        (click)="iniciarJuego()"
        [disabled]="paises().length === 0"
      >
        🎮 Jugar: Adivina el País
      </button>
    </div>
  </div>

  <!-- Modal del Juego (se superpone al contenido) -->
  <div *ngIf="juegoActivo" class="modal-backdrop fade show"></div>
  <div *ngIf="juegoActivo" class="modal fade show d-block" tabindex="-1" style="z-index: 1050">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content game-modal">
        <div class="modal-header">
          <h5 class="modal-title">🎯 Adivina el País</h5>
          <div class="puntuacion">Puntuación: {{ puntuacion }}/{{ intentos }}</div>
        </div>

        <div class="modal-body text-center">
          <!-- Bandera -->
          <div class="bandera-juego mb-4">
            <img
              [src]="paisSecreto?.flags?.png || paisSecreto?.flags?.svg"
              [alt]="'Bandera de ' + paisSecreto?.name?.common"
              class="bandera-img"
            />
          </div>

          <!-- Pregunta -->
          <h4 class="mb-4">¿A qué país pertenece esta bandera?</h4>

          <!-- Opciones -->
          <div class="row">
            <div *ngFor="let opcion of opciones" class="col-12 col-md-6 mb-2">
              <button
                class="btn btn-opcion w-100"
                [class.btn-success]="juegoTerminado && opcion === paisSecreto?.name?.common"
                [class.btn-danger]="
                  juegoTerminado &&
                  opcion === respuestaSeleccionada &&
                  opcion !== paisSecreto?.name?.common
                "
                [class.btn-outline-primary]="
                  !juegoTerminado ||
                  (juegoTerminado &&
                    opcion !== respuestaSeleccionada &&
                    opcion !== paisSecreto?.name?.common)
                "
                (click)="seleccionarRespuesta(opcion)"
                [disabled]="juegoTerminado"
              >
                {{ opcion }}
              </button>
            </div>
          </div>

          <!-- Resultado -->
          <div *ngIf="juegoTerminado" class="resultado mt-3">
            <div *ngIf="respuestaCorrecta" class="alert alert-success">
              ✅ ¡Correcto! Es {{ paisSecreto?.name?.common }}
            </div>
            <div *ngIf="!respuestaCorrecta" class="alert alert-danger">
              ❌ Incorrecto. La respuesta era {{ paisSecreto?.name?.common }}
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button *ngIf="juegoTerminado" class="btn btn-primary" (click)="siguientePregunta()">
            ▶️ Siguiente Pregunta
          </button>
          <button class="btn btn-secondary" (click)="terminarJuego()">🏁 Terminar Juego</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CONTENIDO PRINCIPAL (siempre visible, se difumina cuando el juego está activo) -->
  <div [class.content-blur]="juegoActivo">
    <!-- Filtros -->
    <div class="row mb-4">
      <!-- Filtro por nombre -->
      <div class="col-12 col-md-4 mb-2">
        <input
          type="text"
          class="form-control"
          placeholder="🔎 Buscar por nombre..."
          [(ngModel)]="terminoBusqueda"
        />
      </div>

      <!-- Filtro por capital -->
      <div class="col-12 col-md-4 mb-2">
        <input
          type="text"
          class="form-control"
          placeholder="🏙️ Filtrar por capital..."
          [(ngModel)]="filtroCapital"
        />
      </div>

      <!-- Filtro por región -->
      <div class="col-12 col-md-4 mb-2">
        <select class="form-select" [(ngModel)]="filtroRegion">
          <option value="">🌍 Todas las regiones</option>
          <option *ngFor="let region of regionesUnicas" [value]="region">
            {{ region }}
          </option>
        </select>
      </div>

      <!-- Filtro por población -->
      <div class="col-12 col-md-6 mb-2">
        <input
          type="number"
          class="form-control"
          placeholder="👥 Población mínima"
          [(ngModel)]="poblacionMin"
          min="0"
        />
      </div>

      <div class="col-12 col-md-6 mb-2">
        <input
          type="number"
          class="form-control"
          placeholder="👥 Población máxima"
          [(ngModel)]="poblacionMax"
          min="0"
        />
      </div>

      <!-- Botón limpiar -->
      <div class="col-12 text-center mb-2">
        <button class="btn btn-outline-danger btn-sm" (click)="limpiarFiltros()">
          🗑️ Limpiar filtros
        </button>
        <small class="text-warning d-block mt-1">
          Mostrando {{ filtrarPaises().length }} de {{ paises().length }} países
        </small>
      </div>
    </div>

    <!-- Lista de países -->
    <div class="row">
      <div *ngFor="let pais of filtrarPaises()" class="col-12 col-md-4 mb-4">
        <div class="card h-100">
          <div class="bandera-container">
            <img
              [src]="pais.flags.png || pais.flags.svg"
              [alt]="pais.flags.alt || pais.name.common"
              class="bandera"
            />
          </div>
          <div class="card-body">
            <h3 class="card-title text-center">{{ pais.name.common }}</h3>
            <div class="row">
              <div class="col-6 text-center">
                <p><strong>Oficial (EN):</strong><br />{{ pais.name.official }}</p>
                <p><strong>Oficial (nativo):</strong><br />{{ getNativeOfficialName(pais) }}</p>
                <p><strong>Idiomas:</strong><br />{{ getLanguages(pais) }}</p>
              </div>
              <div class="col-6 text-center">
                <p><strong>Capital:</strong><br />{{ pais.capital?.[0] || '—' }}</p>
                <p><strong>Región:</strong><br />{{ pais.region || '—' }}</p>
                <p><strong>Población:</strong><br />{{ pais.population | number }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
